@startuml
actor Caller
participant ReserveAuctionV1
participant ERC721TransferHelper
participant ERC20TransferHelper


Caller -> ReserveAuctionV1 : createBid()

alt First bid?
    
    ReserveAuctionV1 ->  ReserveAuctionV1 : start auction
    ReserveAuctionV1 -> ERC721TransferHelper : transferFrom()
    ERC721TransferHelper -> ERC721TransferHelper : transfer NFT from seller to escrow

else refund previous bidder

    ReserveAuctionV1 -> ERC20TransferHelper : handle outgoing refund
    ERC20TransferHelper -> ERC20TransferHelper : transfer tokens to bidder

end

ReserveAuctionV1 -> ERC20TransferHelper : handle incoming bid
ERC20TransferHelper -> ERC20TransferHelper : transfer tokens to escrow

alt Bid placed within 15 min of end?
    
    ReserveAuctionV1 ->  ReserveAuctionV1 : extend auction

else noop

end

ReserveAuctionV1 -> ReserveAuctionV1 : emit AuctionBid()

@enduml